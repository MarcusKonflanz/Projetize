@page "/login"
@using Projetize.App.Models.Login
@using Projetize.App.Services
@layout LoginLayout
@inject IAuthService AuthService
@inject NavigationManager Navigation

<PageTitle>Login</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Class="login-container">
    <MudPaper Elevation="4" Class="login-paper">
        <MudImage Src="images/logo.png" Alt="Logo" Class="login-logo" />
        <MudText Typo="Typo.h6" Align="Align.Center" Class="login-title">
            Acesse sua conta
        </MudText>

        <MudForm @ref="form" Model="@loginModel" OnValidSubmit="HandlerLogin">
            <MudTextField Label="Username" @bind-Value="loginModel.Login" For="@(() => loginModel.Login)" Required="true" Variant="Variant.Filled" FullWidth="true" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Person" />
            <MudTextField Label="Password" @bind-Value="loginModel.Password" For="@(() => loginModel.Password)" Required="true" Variant="Variant.Filled" FullWidth="true" InputType="InputType.Password" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Lock" />

            <MudButton Type="Submit" Color="Color.Primary" Variant="Variant.Filled" FullWidth="true" Class="mt-4" OnClick="HandlerLogin">
                Entrar
            </MudButton>

            @if (loginError)
            {
                <MudAlert Severity="Severity.Error" Class="mt-4">
                    Usuário ou senha inválidos.
                </MudAlert>
            }
            <MudText Align="Align.Center" Class="mt-3">
                <MudLink Href="/forgot-password">Forgot password?</MudLink>
            </MudText>
        </MudForm>

    </MudPaper>
</MudContainer>

@code {
    private LoginModel loginModel { get; set; } = new();
    private string ErrorMessage { get; set; }
    private bool loginError = false;
    private MudForm form;

    private async Task HandlerLogin()
    {
        var success = await AuthService.LoginAsync(loginModel);

        if (success)
            Navigation.NavigateTo("/");
        if (!success)
            loginError = true;
    }
}
